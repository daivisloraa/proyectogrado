<script>
// Continuación del objeto de componentes
const components = {
  'Investigación e innovación educativa': ['pregunta1', 'pregunta2', 'pregunta3'],
  'Gestión académica': ['pregunta4', 'pregunta5', 'pregunta6'],
  'Estrategias de evaluación': ['pregunta7', 'pregunta8', 'pregunta9', 'pregunta10'],
  'Prácticas pedagógicas emergentes': ['pregunta11', 'pregunta12', 'pregunta13'],
  'Desarrollo digital estudiantil': ['pregunta14', 'pregunta15'],
  'Comunicación y redes educativas': ['pregunta16', 'pregunta17', 'pregunta18'],
  'Inteligencia Artificial aplicada a la educación': ['pregunta19', 'pregunta20', 'pregunta21']
};

// Evento botón "Enviar respuestas"
document.getElementById("submitBtn").addEventListener("click", () => {
  const institucion = document.getElementById("institucion").value;
  const sector = document.getElementById("sector").value;
  const ciudad = document.getElementById("ciudad").value;
  const correo = document.getElementById("correo").value;

  if (!institucion || !sector || !ciudad || !correo) {
    alert("Por favor complete todos los campos antes de enviar.");
    return;
  }

  const respuestas = {
    institucion,
    sector,
    ciudad,
    correo,
    fecha: new Date().toLocaleString()
  };

  for (const [componente, preguntas] of Object.entries(components)) {
    respuestas[componente] = preguntas.map(id => {
      const radios = document.getElementsByName(id);
      const respuesta = Array.from(radios).find(r => r.checked);
      return respuesta ? respuesta.nextSibling.textContent.trim() : "Sin respuesta";
    });
  }

  // Guardar en localStorage como histórico
  let historial = JSON.parse(localStorage.getItem("diagnosticoHistorico")) || [];
  historial.push(respuestas);
  localStorage.setItem("diagnosticoHistorico", JSON.stringify(historial));

  document.getElementById("result").textContent = "¡Gracias! Tus respuestas han sido guardadas.";
});

// Evento botón "Reiniciar formulario"
document.getElementById("resetBtn").addEventListener("click", () => {
  document.querySelectorAll("input").forEach(input => {
    if (input.type === "radio" || input.type === "text" || input.type === "email") {
      input.checked = false;
      input.value = "";
    }
  });
  document.getElementById("sector").selectedIndex = 0;
  document.getElementById("result").textContent = "";
});

// Evento botón "Descargar histórico"
document.getElementById("downloadHistoryBtn").addEventListener("click", () => {
  const historial = JSON.parse(localStorage.getItem("diagnosticoHistorico")) || [];
  if (historial.length === 0) {
    alert("No hay datos para exportar.");
    return;
  }

  const wb = XLSX.utils.book_new();
  historial.forEach((entry, index) => {
    const datos = [];
    for (const key in entry) {
      if (Array.isArray(entry[key])) {
        datos.push([key, ...entry[key]]);
      } else {
        datos.push([key, entry[key]]);
      }
    }
    const ws = XLSX.utils.aoa_to_sheet(datos);
    XLSX.utils.book_append_sheet(wb, ws, `Respuesta ${index + 1}`);
  });
  XLSX.writeFile(wb, "Historico_Respuestas.xlsx");
});
</script>
